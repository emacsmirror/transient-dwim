#+title: transient-dwim.el
#+author: conao3

[[https://github.com/conao3/transient-dwim.el/blob/master/LICENSE][https://img.shields.io/github/license/conao3/transient-dwim.el.svg?style=flat-square]]
[[https://github.com/conao3/transient-dwim.el/releases][https://img.shields.io/github/tag/conao3/transient-dwim.el.svg?style=flat-square]]
[[https://github.com/conao3/transient-dwim.el/actions][https://github.com/conao3/transient-dwim.el/workflows/Main%20workflow/badge.svg]]

Context-aware transient menus for Emacs.

* Overview

transient-dwim provides a unified entry point to discover and access commands available in your current context. Instead of memorizing keybindings for every mode and package, simply press one key to reveal a clean, organized menu of available actions.

This is especially useful when:
- Exploring a major mode for the first time
- Working with packages you don't use frequently
- Wanting a quick reference of available commands

* Screenshots

** dired-mode
[[https://raw.githubusercontent.com/conao3/files/master/blob/transient-dwim.el/dired-dispatch.png]]

** magit
[[https://raw.githubusercontent.com/conao3/files/master/blob/transient-dwim.el/magit-dispatch.png]]

** origami
[[https://raw.githubusercontent.com/conao3/files/master/blob/transient-dwim.el/origami-dispatch.png]]

* Installation

#+begin_src emacs-lisp
(use-package transient-dwim
  :ensure t
  :bind ("M-=" . transient-dwim-dispatch))
#+end_src

Or with leaf:

#+begin_src emacs-lisp
(leaf transient-dwim
  :ensure t
  :bind ("M-=" . transient-dwim-dispatch))
#+end_src

* Usage

Press =M-== or run =M-x transient-dwim-dispatch=.

The menu will display commands relevant to your current context, whether that's a specific major mode, active minor mode, or installed package.

** Supported Modes and Packages

| Category   | Mode/Package                     |
|------------+----------------------------------|
| Major Mode | dired-mode (built-in)            |
|            | image-dired-thumbnail-mode       |
|            | neotree-mode                     |
|            | magit-mode                       |
| Minor Mode | origami-mode                     |
| Packages   | [[https://github.com/magit/magit][magit]]                            |
|            | [[https://github.com/jaypei/emacs-neotree][neotree]]                          |
|            | [[https://github.com/conao3/dired-git.el][dired-git]]                        |
|            | [[https://github.com/gregsexton/origami.el][origami]]                          |

* Customization

To modify the built-in menus, see the [[https://github.com/magit/transient/blob/master/docs/transient.org#modifying-existing-transients][transient manual]] for guidance on extending transient commands.

Contributions for new menus or improvements are welcome via pull request.

* Creating Custom Menus

To create a transient menu for a package, you can generate a list of interactive functions:

#+begin_src emacs-lisp
(ppp-list
 (cl-flet ((get-summary (str) (replace-regexp-in-string "\\(.*\\)\n.*" "\\1" str)))
   (let (elm info)
     (with-current-buffer "neotree.el"  ; target package buffer
       (save-excursion
         (goto-char (point-min))
         (while (setq elm (ignore-errors (read (current-buffer))))
           (pcase elm
             (`(,(or 'defun 'cl-defun) ,fn ,args (interactive) . ,body)
              (push `(,fn . "") info))
             (`(,(or 'defun 'cl-defun) ,fn ,args (interactive . ,_) . ,body)
              (push `(,fn . "") info))
             (`(,(or 'defun 'cl-defun) ,fn ,args ,docstring (interactive) . ,body)
              (push `(,fn . ,(get-summary docstring)) info))
             (`(,(or 'defun 'cl-defun) ,fn ,args ,docstring (interactive . ,_) . ,body)
              (push `(,fn . ,(get-summary docstring)) info))))))
     (mapcar (lambda (elm) `("" ,(cdr elm) ,(car elm))) (nreverse info)))))
#+end_src

For easier debugging, enable key conflict detection:

#+begin_src emacs-lisp
(setq transient-detect-key-conflicts t)
#+end_src

* Contributing

Contributions are welcome. Please open an issue or submit a pull request.

** Development Setup

1. Install [[https://github.com/cask/cask][Cask]] for dependency management:

   #+begin_src shell
   brew install cask
   #+end_src

   Or manually:

   #+begin_src shell
   git clone https://github.com/cask/cask ~/.cask
   export PATH="$HOME/.cask/bin:$PATH"
   #+end_src

2. Run the tests:

   #+begin_src shell
   make test
   #+end_src

* License

GPL-3.0. See [[https://github.com/conao3/transient-dwim.el/blob/master/LICENSE][LICENSE]] for details.

* Author

Naoya Yamashita ([[https://github.com/conao3][conao3]])
